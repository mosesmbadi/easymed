<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lab Test Report</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        font-size: 14px;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
      }
      th,
      td {
        border: 1px solid #dddddd;
        padding: 8px;
        text-align: left;
      }
      th {
        background-color: #f2f2f2;
      }
      .company-details {
        display: flex;
        align-items: center;
        gap: 20px;
        margin-bottom: 20px;
      }
      .logo-column {
        flex: 0 0 auto;
        border-right: 2px solid #ddd;
        padding-right: 20px;
      }
      .details-column {
        flex: 1;
        padding-left: 20px;
      }
      .logo {
        width: 100px;
        height: auto;
      }
      .header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        padding: 10px;
        background: #e6edf7;
        border: 1px solid #ddd;
        margin-bottom: 20px;
      }
      .header .column {
        flex: 1;
        padding: 0 10px;
      }
      .header .column:not(:last-child) {
        border-right: 2px solid #ddd;
      }
      .report-footer {
        column-count: 2;
        column-gap: 20px;
        line-height: 1.4;
        font-size: 12px;
        margin-top: 30px;
      }
      .report-footer p {
        break-inside: avoid;
        margin: 4px 0;
      }
      .footer {
        text-align: center;
        margin-top: 40px;
        font-size: 12px;
        font-style: italic;
        color: gray;
        font-weight: bold;
      }
      .flag-low {
        color: #d8a500;
      }
      .flag-high {
        color: #d30d0d;
      }
      .flag-normal {
        color: #0d7d2a;
      }
    </style>
  </head>
  <body>
    <div class="company-details">
      <div class="logo-column">
        {% if company_logo_url %}
        <img src="{{ company_logo_url }}" alt="Company Logo" class="logo" />
        {% endif %}
      </div>
      <div class="details-column">
        <p><strong>{{ company.name }}</strong></p>
        <p>Address: {{ company.address1 }}</p>
        <p>
          {{ company.phone1 }} {% if company.email1 %} | {{ company.email1 }} {%
          endif %}
        </p>
      </div>
    </div>

    <div class="header">
      <div class="column">
        <p><strong>Patient Particulars</strong></p>
        <p>{{ patient.first_name }} {{ patient.second_name }}</p>
        <p>Gender: {{ patient.gender }} | Age: {{ patient.age }}</p>
        <p>Patient ID: {{ patient.id }}</p>
        <p>Ref: {{ processtestrequest.reference }}</p>
      </div>
      <div class="column">
        <p><strong>Request Details</strong></p>
        <p><strong>Posted on:</strong> {{ approved_on }}</p>
        <p>
          <strong>Requested By:</strong>
          {% if attendance_process.doctor %} {{
          attendance_process.doctor.first_name }} {% else %} N/A {% endif %}
        </p>
        <p>
          <strong>Done By:</strong>
          {% if attendance_process.lab_tech %} {{
          attendance_process.lab_tech.first_name }} {% else %} _______________
          {% endif %}
        </p>
        <p>
          <strong>Equipment:</strong>
          {% if first_labtestrequest %} {{ first_labtestrequest.equipment }} {%
          else %} _______________ {% endif %}
        </p>
      </div>
      <div class="column">
        <p><strong>Sample</strong></p>
        {% if first_labtestrequest %}
        <p>ID: {{ first_labtestrequest.sample }}</p>
        <p>Type: {{ first_labtestrequest.sample_type }}</p>
        <p>Date: {{ first_labtestrequest.sample_date }}</p>
        {% else %}
        <p>No sample info</p>
        {% endif %}
      </div>
    </div>

    {% if quantitative_panels %}
    <table>
      <thead>
        <tr>
          <th>Test Panel</th>
          <th>Result</th>
          <th>Flag</th>
          <th>Ref Value</th>
          <th>Unit</th>
        </tr>
      </thead>
      <tbody>
        {% for panel in quantitative_panels %}
        <tr>
          <td>{{ panel.test_panel_name }}</td>
          <td>{{ panel.result }}</td>
          <td>
            {% if panel.flag == 'Low' %}
            <span class="flag-low">Low</span>
            {% elif panel.flag == 'High' %}
            <span class="flag-high">High</span>
            {% else %}
            <span class="flag-normal">Normal</span>
            {% endif %}
          </td>
          <td>{{ panel.ref_value_low }} - {{ panel.ref_value_high }}</td>
          <td>{{ panel.unit }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% endif %} {% if qualitative_panels %}
    <table>
      <thead>
        <tr>
          <th>Test Panel</th>
          <th>Result</th>
        </tr>
      </thead>
      <tbody>
        {% for panel in qualitative_panels %}
        <tr>
          <td>{{ panel.test_panel_name }}</td>
          <td>{{ panel.result }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% endif %} {% if first_labtestrequest and first_labtestrequest.note %}
    <p><strong>Notes:</strong></p>
    <p>{{ first_labtestrequest.note }}</p>
    {% endif %}

    <div class="report-footer">
      <p><strong>Date Posted:</strong> {{ approved_on }}</p>
      <p>
        <strong>Requested By:</strong>
        {% if attendance_process.doctor %} {{
        attendance_process.doctor.first_name }} {% else %} N/A {% endif %}
      </p>
      <p>
        <strong>Done By:</strong>
        {% if attendance_process.lab_tech %} {{
        attendance_process.lab_tech.first_name }} {% else %} _______________ {%
        endif %}
      </p>
      <p><strong>Approved By:</strong> Dr. Willy Kanga</p>
      <p>
        <strong>Equipment:</strong>
        {% if first_labtestrequest %} {{ first_labtestrequest.equipment }} {%
        else %} _______________ {% endif %}
      </p>
    </div>

    <section class="footer">
      <span>Generated by: EaSyMed-HMIS</span>
      <p>Email: admin@proto-typesolution.com</p>
    </section>
  </body>
</html>
